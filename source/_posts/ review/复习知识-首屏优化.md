---
title: 复习知识--首屏优化
author: Taoqiupo
date: 2022-02-10 16:53:55
tags: 首屏优化
category: 复习
index_img: https://proxy.qiupo.workers.dev/?https://raw.githubusercontent.com/qiupo/myImages/master/img/202202111123837.png
---
### 首屏优化
&emsp;&emsp;首先祭出神图，来源是 [w3.org](https://proxy.qiupo.workers.dev/?https://www.w3.org/TR/navigation-timing/#sec-window.performance-attribute) 
![](https://proxy.qiupo.workers.dev/?https://raw.githubusercontent.com/qiupo/myImages/master/img/202202111123837.png 'Processing Model')
## 什么是首屏
什么是首屏呢？
&emsp;&emsp;显而易见，这就是打开网址后最先出现在用户面前的页面，在这个首次展现的过程中，我们会遇到很多问题，比如说：输入网址后回车，页面是白色的，需要等待很久才能出来内容。
&emsp;&emsp;那么为了解决这个问题，我们必须了解浏览器首屏的时候都做了什么事情？其实这里面涉及到很多的内容，因为我个人认为首屏时间其实包含用户从输入好网址后回车开始页面出现内容为止这段时间，那么这段时间发生了什么呢？
# 输入url到页面出来中发生了什么？
&emsp;&emsp;我们只讨论其中比较重要的部分，那么显而易见的可以分成以下几个部分([详情可以看另一篇](https://qiupo.github.io/2022/02/11/browser/%E8%BE%93%E5%85%A5url%E5%88%B0%E5%87%BA%E7%8E%B0%E5%86%85%E5%AE%B9%E7%9A%84%E6%B5%81%E7%A8%8B/))：
+ url解析，dns 查询
+ 连接请求
+ 响应并接受资源
+ 页面渲染



## 性能指标有哪些

![](https://proxy.qiupo.workers.dev/?https://raw.githubusercontent.com/qiupo/myImages/master/img/202202101748527.png 'performance返回值')
1. If the navigation is aborted for any of the following reasons, abort these steps without changing the attributes in window.performance.timing and window.performance.navigation.
    + The navigation is aborted due to the sandboxed navigation browsing context flag or the sandboxed top-level navigation browsing context flag, or a preexist attempt to navigate the browsing context.
    + The navigation is caused by fragment identifiers within the page.
    + The new resource is to be handled by some sort of inline content.
    + The new resource is to be handled using a mechanism that does not affect the browsing context.
    + The user refuses to allow the document to be unloaded.
2. Immediately after the user agent prompts to unload the previous document, record the current time as navigationStart.
3. Record the current navigation type in window.performance.navigation.type if it has not been set:
    + If the navigation was started by clicking on a link, or entering the URL in the user agent's address bar, or form submission, or initializing through a script operation other than the location.reload() method, let the navigation type be TYPE_NAVIGATE.
    + If the navigation was started either as a result of a meta refresh, or the location.reload() method, or other equivalent actions, let the navigation type be TYPE_RELOAD.
    + If the navigation was started as a result of history traversal, let the navigation type be TYPE_BACK_FORWARD.
    + Otherwise, let the navigation type be TYPE_RESERVED.
4. If the current document and the previous document are from different origins, set both unloadEventStart and unloadEventEnd to 0 then go to step 6. Otherwise, record unloadEventStart as the time immediately before the unload event.
5. Immediately after the unload event is completed, record the current time as unloadEventEnd.
6. If the new resource is to be fetched using HTTP GET or equivalent, immediately before a user agent checks with the relevant application caches, record the current time as fetchStart. Otherwise, immediately before a user agent starts the fetching process, record the current time as fetchStart.
7. Let domainLookupStart, domainLookupEnd, connectStart and connectEnd be the same value as fetchStart.
8. If the resource is fetched from the relevant application cache or local resources, including the HTTP cache, go to step 13.
9. If no domain lookup is required, go to step 11. Otherwise, immediately before a user agent starts the domain name lookup, record the time as domainLookupStart.
10. Record the time as domainLookupEnd immediately after the domain name lookup is successfully done. A user agent may need multiple retries before that. If the domain lookup fails, abort the rest of the steps.
11. If a persistent transport connection is used to fetch the resource, let connectStart and connectEnd be the same value of domainLookupEnd. Otherwise, record the time as connectStart immediately before initiating the connection to the server and record the time as connectEnd immediately after the connection to the server or the proxy is established. A user agent may need multiple retries before this time. If a connection can not be established, abort the rest of the steps.
12. In step 11, a user agent should also carry out these additional steps if it supports the secureConnectionStart attribute:
    + If the scheme of the current document is HTTPS, the user agent must record the time as secureConnectionStart immediately before the handshake process to secure the connection.
    + If the scheme of the current document is not HTTPS, the user agent must set the value of secureConnectionStart to 0.
13. Immediately before a user agent starts sending request for the document, record the current time as requestStart.
14. Record the time as responseStart immediately after the user agent receives the first byte of the response.
15. Record the time as responseEnd immediately after receiving the last byte of the response.
16. If the fetched resource results in an HTTP redirect or equivalent, then
    + if the current document and the document that is redirected to are not from the same origin, set redirectStart, redirectEnd, unloadEventStart, unloadEventEnd and redirectCount to 0. Then, return to step 6 with the new resource.
    + if there is previous redirect involving documents that are not from the same origin, set redirectStart, redirectEnd, unloadEventStart, unloadEventStart and redirectCount to 0. Then, return to step 6 with the new resource.
    + Increment redirectCount by 1.
    + If the value of redirectStart is 0, let it be the value of fetchStart.
    + Let redirectEnd be the value of responseEnd.
    + Set all the attributes in window.performance.timing to 0 except navigationStart, redirectStart, redirectEnd, unloadEventStart and unloadEventEnd.
    + Return to step 6 with the new resource.
17. Record the time as domLoading immediately before the user agent sets the current document readiness to "loading".
18. Record the time as domInteractive immediately before the user agent sets the current document readiness to "interactive".
19. Record the time as domContentLoadedEventStart immediately before the user agent fires the DOMContentLoaded event at the document.
20. Record the time as domContentLoadedEventEnd immediately after the DOMContentLoaded event completes.
21. Record the time as domComplete immediately before the user agent sets the current document readiness to "complete".
22. Record the time as loadEventStart immediately before the user agent fires the load event.
23. Record the time as loadEventEnd immediately after the user agent completes the load event.
[](https://proxy.qiupo.workers.dev/?https://raw.githubusercontent.com/qiupo/myImages/master/img/202202101748527.png '参数')
## 可以做什么来优化
## 怎么监控性能